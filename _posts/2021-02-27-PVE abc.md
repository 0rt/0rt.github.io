---
layout: article
title: PVE初探
author :
mathjax: true
mermaid: true
chart: true
mathjax_autoNumber: true
toc: true
tags : 软路由 安装 PVE
key: PVE
mode: immersive
header:
  theme: dark
article_header:
  type: overlay
  theme: dark
  background_color: '#ffffff'
  background_image:
    gradient: 'linear-gradient(0deg, rgba(0, 0, 0 , .3), rgba(0, 0, 0, .3))'
    src: assets/background/morning.jpg
---
会在接下来继续家庭网络端的一些折腾经历
<!--more-->

# PVE虚拟机初体验

## 硬件
当年口水了软路由很久了，自觉业务能力和闲钱也不是很够，一直都是K2，K2P，newifi这样用过来。其实几年前（看网卡的易碎贴，应该是2015年）离真正装软路由就一步之遥，我买好了N3150的单网口小主板，一个很小的正方形ITX机箱，还有一块富士通的双千兆Intel PCIE 4x网卡，因为我有点环保执着，看见网上主流的N3150小主机功耗都是7w以下，还顺便买了功率计。结果U盘做启动盘，ATX电源+PCIE卡，插上开机以后待机功率就达到14W，大大过于我的预定值，正好那时候我爸炒股票的老爷机坏了，就把那台自己给他用了，小机器和那个二手80G硬盘服役到现在，想不多4年多以后今天买软路由，依然还是买N3150，挤牙膏真不是开玩笑的。

一下子买了两台，预计是留下一台以后另外一台转手出去的。

一台是N3160+螃蟹双千兆网口，4GB+128GB，这台是正经的软路由，自己有两个网卡插口了，规格比不过那些用i210 350的，家用够不够用待测试，这个先到货。样子是这样的：
![router](https://img.vim-cn.com/24/f65799b254479f68705eac4e176316192912c2.png)

另外一台今天也快递到了，原来是家用小主机，J3160（对了规格表半天，我觉得J3160和N3160就是没区别），4GB+32GB，只有一个网口，自带一个无线网卡和两条小天线，想法是将上面提到早年买的富士通网卡利用起来，然后看哪台性能好就留下。第二台是这样子的：
![router2](https://img.vim-cn.com/b1/30a8c93a48145ae250cb879cd3ec0bbee57b1c.png)

到这里不得不对还没有入手硬件的朋友提个醒，一个是硬件参数必须提前了解清楚，比如对于路由器，对网卡重要影响的是SR-IOV，对CPU关键的就是VT-x，VT-d这些是关于能不能建虚拟机及能不能实现硬件直通的，还有AES是关于加解密的指令集，最常见的就是扶墙应用往往都是比较高度使用AES指令集加密数据包的。部分CPU支持功能能不能开启还和主板支持有关。要尽可能购买前和卖家了解清楚，避免满心欢喜买，收到后发现有硬伤时扯皮闹心。

这里给出一份昨晚才看见的常用x86软路由CPU的重点特性、功耗还有参考单核性能。
![router_cpu](https://img.vim-cn.com/6a/c9b43d0361909c0a3f43d3d1f02a6e5d0b8002.jpg)

还有不要盲目跟风，比如J1900性能和保有量其实不足以支撑现在400+的售价的，二手市场很容易炒作起来，理性消费。比如先在选用什么CPU前，好好问清楚自己，是否真的需要软路由提供的功能。


---


## PVE安装


可从Bilibili上搜索PVE会有很多安装教程视频的，我也是按着来。基本没有坑。
- [PVE官网](https://pve.proxmox.com/wiki/Downloads)下载PVE的ISO文件（至现在最新版6.3 约800MB）
- UltraISO等工具写入ISO镜像到一个U盘（U盘所有文件会清除）
- 用写好的U盘启动软路由机器
- U盘启动机器后就是下一步，比较要紧的是
  -  账号密码
  -  有不止一个硬盘时要选好安装的硬盘
  -  指定PVE后台ip地址的，以后就通过这个IP对PVE及虚拟机控制和设置，下面以我用的192.168.77.7为例。
- 安装完成后会重启安装就算完成了
- PC设置IP地址是同网段，192.168.77.x x不等于7的1-254整数，子网掩码 255.255.255.0
- PC网线连接软路由，软路由绑定哪一个网卡在安装过程中是有选择的，不清楚一个一个试，直到192.168.77.7能ping通。
- 在浏览器中（不要用IE）http**s**://192.168.77.7:8006 打开PVE后台

因为我只有闲置的老D-Sub接口显示器，安装时HDMI连家里的电视机，显示界面跑出显示范围外了，还好“下一步”按钮可以看到。
![router_next](https://img.vim-cn.com/a1/528fb4b10033a803f0744767444bfb045e103d.jpg)


